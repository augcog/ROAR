import numpy as np
from scipy.interpolate import interp1d

'''
waypoints=np.array([[-809.3580322265625,75.23435974121094,-689.728515625],
  [-809.0762329101562,75.22408294677734,-689.728515625],
  [-808.2606201171875,75.19297790527344,-689.7285766601],
  [-807.1472778320312,75.15070343017578,-689.72857666015],
  [-805.7420043945312,75.097412109375,-689.7286376953125],
  [-802.8228759765625,74.98616027832031,-689.728759765625],
  [-797.173828125,74.77111053466797,-689.7276611328125],
  [-788.5076904296875,74.4395980834961,-689.72216796875],
  [-775.615478515625,73.9448471069336,-689.7166748046875],
  [-760.724853515625,73.37155151367188,-689.7098388671875],
  [-740.7571411132812,72.6004638671875,-689.6984252929688],
  [-718.8038940429688,71.75043487548828,-689.6876220703125],
  [-693.8598022460938,70.78234100341797,-689.6741333007812],
  [-665.5414428710938,69.68099212646484,-689.6575927734375],
  [-635.0728759765625,68.48372650146484,-688.0350341796875],
  [-604.5775756835938,66.9469985961914,-684.9996948242188],
  [-570.5679931640625,65.2376708984375,-681.5734252929688],
  [-533.716796875,63.38698196411133,-677.8607788085938],
  [-491.38299560546875,61.267879486083984,-675.19146728],
  [-451.9557800292969,59.30031967163086,-673.96527099609],
  [-417.541748046875,57.5843391418457,-672.9406127929688],
  [-389.7806701660156,56.2005500793457,-672.1248779296875],
  [-369.6275634765625,55.19593811035156,-671.3775634765625],
  [-354.6678466796875,54.447933197021484,-670.114501953125],
  [-342.56768798828125,53.84300994873047,-669.0671997070312],
  [-330.6973876953125,53.24973678588867,-668.0393676757812],
  [-319.63787841796875,52.6971435546875,-667.081787109375],
  [-306.1018371582031,52.021018981933594,-665.910034179687],
  [-289.578857421875,51.19602584838867,-664.4799194335938],
  [-270.55096435546875,50.24639892578125,-662.833190917968],
  [-246.87283325195312,49.065643310546875,-660.784301757812],
  [-228.5359344482422,48.15170669555664,-659.1975708007812],
  [-214.5048370361328,47.45225143432617,-657.9827880859375],
  [-204.7995147705078,46.96854019165039,-657.1421508789062],
  [-195.51959228515625,46.50618362426758,-656.3377075195312],
  [-186.23843383789062,46.04389572143555,-655.5337524414062],
  [-176.3165740966797,45.549842834472656,-654.6741943359375],
  [-163.29434204101562,44.90163803100586,-653.5464477539062],
  [-147.01004028320312,44.093711853027344,-652.8087158203125],
  [-128.37893676757812,43.17076873779297,-652.2431030273438],
  [-105.71251678466797,42.04734802246094,-651.1639404296875],
  [-79.65052795410156,40.75490188598633,-649.3843383789062],
  [-52.27614212036133,39.39864730834961,-647.5089111328125],
  [-19.794401168823242,37.79124069213867,-645.284362792968],
  [8.496942520141602, 36.39303207397461,-643.3470458984375],
  [45.83399963378906,34.55072021484375,-640.7908935546875],
  [82.8395004272461,32.728572845458984,-638.2579956054688],
  [122.0561294555664,30.802465438842773,-635.5744018554688],
  [162.21693420410156,28.836416244506836,-632.8268432617188],
  [203.68345642089844,26.81519317626953,-629.9907836914062],
  [250.3085479736328,24.557214736938477,-626.8028564453125],
  [293.5520935058594,22.484479904174805,-623.8468017578125],
  [345.47479248046875,20.051513671875,-620.2987060546875],
  [391.50115966796875,18.131851196289062,-617.15496826171],
  [441.7917175292969,15.796083450317383,-613.9814453125],
  [489.8133850097656,13.5514497756958,-612.1517333984375],
  [535.9437866210938,11.391237258911133,-610.662658691406],
  [578.09521484375,9.416276931762695,-609.3435668945312],
  [607.7294921875,8.028932571411133,-608.4695434570312],
  [630.7010498046875,6.9548821449279785,-607.8356323242],
  [648.882080078125,6.105073928833008,-606.9834594726562],
  [663.0945434570312,5.440619468688965,-605.8239135742188],
  [677.4780883789062,4.770054817199707,-605.0223388671875],
  [691.6351928710938,4.111509799957275,-604.27587890625],
  [709.6629638671875,3.2754626274108887,-603.32525634765],
  [730.1080932617188,2.3323402404785156,-602.247253417968],
  [753.2805786132812,1.2747145891189575,-601.0258178710938],
  [778.4314575195312,0.17303462326526642,-599.7001953125],
  [801.3394165039062,0.10618613660335541,-598.49249267578],
  [817.2098388671875,0.10143546760082245,-597.612915039062],
  [827.9476928710938,0.09349697083234787,-596.3673706054688],
  [835.9252319335938,0.08636531978845596,-593.6763305664062],
  [842.8505859375,0.08041469752788544,-590.3863525390625],
  [849.7598876953125,0.07838474214076996,-585.849975585937],
  [856.4915161132812,0.07829662412405014,-577.947998046875],
  [861.8917846679688,0.07823996990919113,-567.5303955078125],
  [865.1549072265625,0.07826988399028778,-552.9174194335938],
  [867.0563354492188,0.0783206894993782,-535.1093139648438],
  [866.7001953125,0.07837162166833878,-513.830322265625],
  [863.91796875,0.07841411232948303,-489.7491760253906],
  [859.1399536132812,0.07842773199081421,-464.976928710],
  [856.6547241210938,0.07842208445072174,-438.5572509765],
  [853.6356811523438,0.07843925058841705,-406.51388549804],
  [845.4365234375,0.07915736734867096,-378.2944030761719],
  [836.5067749023438,0.07910552620887756,-358.57888793945],
  [829.5383911132812,0.07889697700738907,-346.249572753906],
  [824.2770385742188,0.0787024274468422,-336.9861145019531],
  [820.137451171875,0.07856723666191101,-329.4018249511719],
  [816.3783569335938,0.07845527678728104,-321.2076721191406],
  [812.7916870117188,0.07836944609880447,-312.3741760253906],
  [808.3713989257812,0.07829628139734268,-299.61187744140625],
  [803.91796875,0.0783211886882782,-283.7774658203125],
  [799.869384765625,0.07839103788137436,-266.099609375],
  [795.472412109375,0.07848777621984482,-244.6464538574],
  [791.56201171875,0.07860904186964035,-220.875106811523],
  [788.0629272460938,0.07876171171665192,-194.31057739257],
  [784.2738647460938,0.07894077152013779,-165.452362060546],
  [780.2094116210938,0.07914474606513977,-134.4914245605468],
  [777.0760498046875,0.07935646176338196,-103.45977020263672],
  [774.3048095703125,0.07960956543684006,-67.88689422607422],
  [771.5118408203125,0.07987430691719055,-31.68076515197754],
  [768.5834350585938,0.0801578089594841,6.292068958282471],
  [765.45849609375,0.08075354993343353,46.82291793823242],
  [762.83203125,0.08153922855854034,80.89134979248047],
  [760.8206787109375,0.0816277265548706,106.9536895751],
  [760.1641845703125,0.08169513195753098,126.2814788818],
  [760.850830078125,0.08158645778894424,139.478607177734],
  [761.3657836914062,0.08151839673519135,149.814788818359],
  [761.5983276367188,0.08147605508565903,159.1691284179687],
  [761.5203857421875,0.08145690709352493,168.93679809570312],
  [761.3384399414062,0.08146419376134872,180.13262939453125],
  [761.103759765625,0.08151542395353317,194.5681915283203],
  [760.8268432617188,0.08166175335645676,211.6043701171875],
  [760.5243530273438,0.08231445401906967,230.25355529785156],
  [760.2745971679688,0.08253318816423416,245.62229919433594],
  [760.103515625,0.08243472874164581,256.1563720703125],
  [759.9674682617188,0.0823613703250885,264.51028442382],
  [759.8465576171875,0.08232036232948303,271.91671752929],
  [759.7124633789062,0.08230853825807571,280.175476074218],
  [759.544921875,0.082310251891613,290.4698791503906],
  [759.36083984375,0.08232875913381577,301.8110351562],
  [759.1094360351562,0.08245304226875305,317.270385742],
  [758.804931640625,0.08261146396398544,336.04690551757],
  [758.44677734375,0.0832439437508583,358.1063232421875],
  [758.1847534179688,0.08351314067840576,374.24029541015],
  [757.9266967773438,0.08342037349939346,387.165679931640],
  [757.5571899414062,0.08335178345441818,397.1681213378906],
  [757.1998901367188,0.08331199735403061,406.8180847167969],
  [756.8566284179688,0.08329372107982635,416.0914611816406],
  [756.4102172851562,0.08329242467880249,428.1499938964844],
  [755.9038696289062,0.0833449512720108,441.8319091796875],
  [755.225830078125,0.0834842249751091,460.16015625],
  [754.4551391601562,0.08362914621829987,481.0051574],
  [753.6002197265625,0.08412323147058487,504.13650512],
  [752.88623046875,0.08457748591899872,523.44641113281],
  [752.3884887695312,0.08447425812482834,536.8919677734],
  [752.044677734375,0.08435375243425369,546.183959960937],
  [751.7313232421875,0.08427715301513672,554.64501953125],
  [751.4503784179688,0.08422710001468658,562.2392578125],
  [751.0996704101562,0.08417575806379318,571.7080078125],
  [750.6992797851562,0.08413032442331314,582.52783203125],
  [750.1663208007812,0.08413688838481903,596.934814453125],
  [749.17919921875,0.08155952394008636,614.7531127929688],
  [745.6527709960938,0.08267329633235931,635.915283203125],
  [738.9053955078125,0.13464106619358063,656.380859375],
  [727.8798217773438,0.3162773847579956,678.5751953125],
  [710.4852294921875,0.9460831880569458,699.931640625],
  [688.6326904296875,4.144077301025391,713.87701416015],
  [658.7706909179688,8.683629035949707,718.660583496093],
  [630.5635375976562,13.09977912902832,719.2796020507812],
  [599.7530517578125,18.012725830078125,719.9130859375],
  [569.2987060546875,22.89655876159668,720.552429199218],
  [538.289306640625,27.847137451171875,721.2153930664062],
  [504.51226806640625,33.116058349609375,721.012390136718],
  [472.405029296875,37.317047119140625,719.66796875],
  [435.7933044433594,41.17911148071289,716.995056152],
  [400.1983947753906,45.24750900268555,712.9342041015],
  [364.83056640625,49.56330108642578,708.7581787109375],
  [327.63714599609375,54.362762451171875,706.5150756835],
  [290.757568359375,59.357322692871094,704.55615234375],
  [249.15223693847656,65.14408874511719,702.89910888671],
  [211.57696533203125,70.36060333251953,703.355041503906],
  [172.4545135498047,75.62596130371094,704.0888061523438],
  [135.875732421875,80.29251098632812,704.7815551757812],
  [110.36399841308594,83.37220764160156,705.267883300781],
  [92.88188171386719,85.39679718017578,705.6030883789062],
  [77.61589050292969,87.1080551147461,705.8966064453125],
  [64.81441497802734,88.5030517578125,706.1437377929688],
  [52.805564880371094,89.77924346923828,706.376342773437],
  [38.35899353027344,91.2740249633789,706.6563110351562],
  [20.22562026977539,93.08999633789062,707.0092163085938],
  [2.432361364364624,94.8095703125,707.3563232421875],
  [-19.80540657043457,96.86284637451172,707.791015625],
  [-41.6926155090332,98.44142150878906,709.08178710937],
  [-66.89586639404297,99.45069885253906,713.93029785156],
  [-92.0779800415039,100.16446685791016,720.629333496093],
  [-120.98502349853516,101.5010986328125,728.376525878906],
  [-152.42413330078125,103.20191192626953,736.254272460937],
  [-183.8112335205078,104.84072875976562,741.0759887695312],
  [-215.93942260742188,106.4344711303711,743.5167236328125],
  [-251.72723388671875,108.07404327392578,746.1078491210938],
  [-292.1725769042969,109.64546966552734,748.0030517578125],
  [-327.66473388671875,110.97896575927734,747.913330078125],
  [-368.9630432128906,112.74661254882812,745.783203125],
  [-410.82421875,114.68193817138672,743.2671508789062],
  [-450.39569091796875,116.53128814697266,740.88372802],
  [-482.2604064941406,117.9388427734375,738.708984375],
  [-506.4571228027344,118.9177474975586,735.4512329101],
  [-524.6658935546875,119.59038543701172,731.7294921875],
  [-539.756591796875,120.09508514404297,728.615600585937],
  [-555.1009521484375,120.55497741699219,725.451049804687],
  [-571.6557006835938,120.99468231201172,721.1677856445312],
  [-588.8434448242188,121.41246795654297,715.0521850585938],
  [-603.8509521484375,121.8031234741211,703.7392578125],
  [-614.5641479492188,121.98477935791016,685.2424926757],
  [-621.8574829101562,121.71955108642578,661.35583496093],
  [-628.1397705078125,121.25922393798828,633.630798339843],
  [-632.4320068359375,120.71343231201172,605.822265625],
  [-634.3782958984375,120.01387786865234,573.3489990234],
  [-635.2767333984375,119.2319564819336,539.493835449218],
  [-638.7056884765625,118.34758758544922,503.340209960937],
  [-642.481689453125,117.40424346923828,466.2295227050781],
  [-645.165771484375,116.4360580444336,429.1663513183594],
  [-647.895751953125,115.31411743164062,387.2433166503906],
  [-650.693359375,114.13484191894531,344.11163330078125],
  [-653.347900390625,112.99677276611328,303.185668945312],
  [-655.5419921875,112.04241180419922,269.34478759765625],
  [-657.2734375,111.28105163574219,242.60470581054688],
  [-658.4852294921875,110.74394989013672,223.867980957],
  [-659.3226318359375,110.37107849121094,210.9200134277],
  [-660.0148315429688,110.06188201904297,200.21571350097],
  [-660.6925048828125,109.75859069824219,189.743255615234],
  [-661.4109497070312,109.43606567382812,178.6340789794922],
  [-662.2704467773438,109.04918670654297,165.3466033935547],
  [-663.3532104492188,108.56059265136719,148.61761474609375],
  [-664.6251220703125,107.98462677001953,128.97189331054688],
  [-666.073486328125,107.32621002197266,106.60651397705078],
  [-667.9379272460938,106.53421783447266,79.8297348022461],
  [-670.974365234375,105.77948760986328,54.54947280883789],
  [-674.7523803710938,104.89042663574219,24.91836357116699],
  [-678.356689453125,104.07041931152344,-2.320784091949463],
  [-681.984619140625,103.45225524902344,-22.66825294494629],
  [-685.4642944335938,103.01127624511719,-37.00617218017578],
  [-689.300048828125,102.57484436035156,-51.10421371459961],
  [-693.4561767578125,102.17305755615234,-63.93155670166015],
  [-698.5075073242188,101.72312927246094,-78.21791076660156],
  [-705.7349243164062,101.2367172241211,-93.16981506347656],
  [-716.441650390625,100.65266418457031,-110.65009307861328],
  [-729.4010620117188,99.8906021118164,-131.5888214111328],
  [-744.20849609375,98.98362731933594,-153.83140563964844],
  [-761.6500854492188,97.90552520751953,-177.3014678955078],
  [-779.359130859375,96.73688507080078,-201.00051879882812],
  [-798.3561401367188,95.34197235107422,-228.47457885742188],
  [-817.1926879882812,93.76297760009766,-259.5234069824219],
  [-832.2808227539062,92.28446197509766,-289.53680419921875],
  [-840.9760131835938,91.12580871582031,-314.848388671875],
  [-843.9190673828125,90.38610076904297,-332.2483825683594],
  [-847.135009765625,89.80278015136719,-345.5859375],
  [-848.7606811523438,89.33572387695312,-356.0747070],
  [-849.8139038085938,88.90413665771484,-365.61886596],
  [-850.889892578125,88.40562438964844,-376.5025329589],
  [-851.66162109375,87.77137756347656,-390.258087158203],
  [-851.34765625,87.03764343261719,-406.0965881347656],
  [-849.432373046875,86.12552642822266,-425.7073059082],
  [-846.766845703125,85.0939712524414,-448.081634521484],
  [-842.9993286132812,83.92863464355469,-473.83843994140],
  [-838.4620361328125,82.61882781982422,-503.869995117187],
  [-835.5492553710938,81.46131134033203,-532.0592041015625],
  [-835.0953979492188,80.20372009277344,-564.1478271484375],
  [-838.5609130859375,78.77102661132812,-597.9396362304688],
  [-842.900146484375,77.65959167480469,-624.913330078125],
  [-844.9174194335938,76.9090576171875,-645.45751953125],
  [-845.2587280273438,76.47354125976562,-659.20928955078],
  [-845.497314453125,76.33317565917969,-670.300048828125],
  [-844.835205078125,76.33845520019531,-680.0692749023438],
  [-842.0962524414062,76.34590911865234,-686.3538818359375],
  [-839.4750366210938,76.31749725341797,-689.7864990234375],
  [-835.970458984375,76.20855712890625,-691.9818725585938],
  [-831.1350708007812,76.03633117675781,-693.5362548828125],
  [-824.87841796875,75.80956268310547,-694.4835815429688],
  [-816.2412109375,75.49065399169922,-695.1272583007812],
  [-803.7725830078125,75.0232925415039,-695.673400878906],
  [-798.2015380859375,74.81283569335938,-695.630615234375]])
'''
waypoints = []
with open('F:\Team_roar\ROAR\ROAR_Sim\data\\berkeley_minor_waypoints.txt', 'r') as f:
    data = f.readlines() 
 
    for line in data:
        odom = line.rstrip().split(',')
        numbers_float = list(map(float, odom))
        #print numbers_float
        waypoints.append(numbers_float)
waypoints = np.array(waypoints)

#waypoints = np.loadtxt('F:\Team_roar\ROAR\ROAR_Sim\data\\berkeley_minor_waypoints.txt')
# print(waypoints)()
wptsx=waypoints[:,0]  
wptsy=waypoints[:,1]  
wptsz=waypoints[:,2]  


# get x column

x = np.arange(0, len(waypoints)).T


fx = interp1d(x, wptsx, kind='cubic')
fy = interp1d(x, wptsy, kind='cubic')
fz = interp1d(x, wptsz, kind='cubic')

print(len(waypoints))
xnew = np.arange(0, len(waypoints)-1,.2)
intrpx=fx(xnew)
intrpy=fy(xnew)
intrpz=fz(xnew)
print('xvalues: ', intrpx)

import matplotlib.pyplot as plt
# plt.figure(figsize=(25,40))

# plt.subplot(511)
# plt.plot(x, wptsx, 'o', xnew, intrpx, '-')
# plt.gca().invert_yaxis()

# plt.subplot(512)
# plt.plot(x, wptsy, 'o', xnew, intrpy, '-')
# plt.gca().invert_yaxis()

# plt.subplot(513)
# plt.plot(x, wptsz, 'o', xnew, intrpz, '-')
# plt.gca().invert_yaxis()

# plt.subplot(514)
# plt.plot(wptsx,wptsz,'o',intrpx,intrpz,'-' )
# plt.gca().invert_yaxis()

# plt.subplot(515)
# plt.plot(wptsx,wptsz,'-',intrpx,intrpz,'o' )

# fig = plt.figure()

# ax = fig.add_subplot(111)
# ax.set_aspect('equal', adjustable='box')
plt.figure(figsize=(15,15))
plt.gca().invert_yaxis()
plt.plot(wptsx,wptsz,'o',intrpx,intrpz,'-' )
plt.gca().invert_yaxis()
plt.xlabel("x-axis")
plt.ylabel("z-axis")


plt.legend(['data', 'cubic'], loc='best')
plt.gca().invert_yaxis()
plt.show()

xpt=np.asarray(intrpx)
#print(xpt)
ypt=np.asarray(intrpy)
#print(ypt)
zpt=np.asarray(intrpz)
#print(zpt)
newpoints1 = np.stack((intrpx, intrpy, intrpz), axis=0).T
newpoints =np.around(newpoints1, 2)
# npts=np.transform
#print('newpoints: ')
#print(newpoints)
#for i in range(len(newpoints)):
#  print (newpoints [i,0],',',newpoints[i,1],',',newpoints[i,2])
np.savetxt('F:\Team_roar\ROAR\ROAR_Sim\data\\berkeley_minor_new_waypoints.txt', newpoints, delimiter=',',fmt='%.014f')
'''
with open('F:\Team_roar\ROAR\ROAR_Sim\data\\berkeley_minor_new_waypoints.txt', 'w') as f:
    for line in newpoints:
      f.write(str(line[0]))
      f.write(',')
      f.write(str(line[1]))
      f.write(',')
      f.write(str(line[2]))
      f.write('\n')
'''